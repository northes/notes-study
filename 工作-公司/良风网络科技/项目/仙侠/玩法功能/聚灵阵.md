核心玩法：

https://www.kdocs.cn/l/ckNlEAypWlDY

1.  从创角开始计时，可以累积最多x秒（由 `默认可累积时长上限` 和 `额外时长上限` 决定）
2.  玩家可以在任意时间结算累积的时间，用于兑换一些奖励（类似离线结算机制，但不完全相同），所能领取的奖励受玩家当前进度决定。（经验、金币、道具）
3.  基于目前的时间道具掉落系统的设计模式另外实现。
4.  联动活动时，结算规则如下：
	1.  `当前时间`-`上次领奖时间`作为结算时长，也就是玩家可以主动攒一些时间，以便在活动开始时立即获得一波活动道具。

Issue：
/bac
https://gitlab.shouyouqianxian.com/xia/game_server/-/issues/72

---

## 累积时长

1. 满足最低开启条件后才开始计算时间。
2. 全局表配置项 `force_collector_base_seconds` 表示 `默认状态下玩家最多可累积的时间上限`。
3. Attr `聚灵阵额外时长上限` 描述玩家可以额外获得的累积时长上限。
4. 允许玩家通过邀请助力的方式，增加 `允许累积的最大时长`
	1. 全局配表项 `force_collector_invite_max_count` 表示 `允许邀请的玩家数上限`
	2. 全局配表项 `force_collector_extra_seconds_per_invite` 表示 `邀请单个玩家可以获得的累积时间上限`
5. 玩家达到 `允许累积的最大时长` 后，如未结算则不会再继续累积。

## 结算规则

1. 玩家只能手动结算，并且所能兑换的奖励只受点击结算时的主线任务进度影响。
2. 任务进度推进前的奖励不会自动结算。
3. 配表中当前主线任务进度未配置奖励的，将向前寻找直至找到可用的进度奖励：
	1. 如：配表中只配了 10,12,18 的主线任务进度奖励，当玩家结算时进度为 ID 15 时，将向前寻找并使用已配置的进度 ID 12 的进度奖励进行结算。
4. 当玩家点击结算的时间间隔过短，不足以产生任何一个奖励时，结算响应结果将为空。

## 计算公式

1. 产出单个奖励所需的时间计算公式为：`单日总秒数(86400)` / `单日共会产出的奖励数量`
2. 允许累积的最大时长的计算公式为： `默认状态下玩家最多可累积的时间上限` + `聚灵阵额外时长上限` + (`邀请单个玩家可以获得的累积时间上限` * 邀请成功的玩家数)
3. 产出数量的计算公式为：`当前时间` - `上次结算时间` / `产出单个奖励所需的时间`
	1. 如果 `当前时间` - `上次结算时间` 超出 `允许累积的最大时长` ，则使用 `允许累积的最大时长` 作为计算产出的依据。并校准玩家结算的时间戳。

## 校准

1. 当玩家的 `上次结算时间` 为空时，将会被校准为 `当前时间`
2. 当玩家的 `上次结算时间` 在 `当前时间` 之后时，将被校准为 `当前时间`