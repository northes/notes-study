## 初始化

### 私有仓库

配置私有仓库 [[私有仓库初始化]]

### 依赖
1.  `beego` 需要手动切到 `develop-1.x` 分
2. 报错
```
..\..\..\..\github.com\prometheus\common\expfmt\decode.go:89:38: cannot use v (variable of type *io_prometheus_client.MetricFamily) as type protoreflect.ProtoMessage in argument to pbutil.ReadDelimited:
        *io_prometheus_client.MetricFamily does not implement protoreflect.ProtoMessage (missing ProtoReflect method)
..\..\..\..\github.com\prometheus\common\expfmt\encode.go:120:40: cannot use v (variable of type *io_prometheus_client.MetricFamily) as type protoreflect.ProtoMessage in argument to pbutil.WriteDelimited:
        *io_prometheus_client.MetricFamily does not implement protoreflect.ProtoMessage (missing ProtoReflect method)
```
找到对应的文件，注释掉相关代码即可，目前没有发现啥问题

3. 报错
beego 报 lru 错（后台）
找到 `$GOPATH/src/github.com/hashicorp/golang-lru` ，切换到 `master` 分支，签出 tag  `v0.6.0`  的提交


4. 首次在空数据库运行报错
 确定数据库的字符集是否为 utf8_bin

### 创建文件夹

- trace
- log

### 编辑

一些使用vendor组织包的项目，Goland无法识别，通过以下方法解决

1. 移动项目到 `$GOPATH/src` 目录下
2. Goland 设置取消勾选 `使用Go模块集成`

### 配置文件

直接放到项目conf目录下即可
![[Pasted image 20221114104237.png]]


###  数据库修改

**game_server**
- user
- user_ext
- user_ext2
 
 三张表的行格式修改为 `Compressed`

**backend**
- grpc_op_history

`request` 字段类型修改为 `longtext` ，长度为 0

## 版本管理

通过分支进行游戏大版本管理

代码合并使用 `rebase` ，主要是为了美观

最新开发平台为 `intl`，如果其他平台报找不到配表文件等情况，可以尝试切到 `intl` 再次运行

## game_server

### 运行

```shell
go run --tags="intl,dev,game" main.go
```

### 镜像推送

```shell
sh ./docker/push/auto.sh andr_hk dev game
```

### 配表更新

需安装 `bing` ctl工具

```shell
go get gitlab.shouyouqianxian.com/bingo/bing
go install gitlab.shouyouqianxian.com/bingo/bing
```

更新配表：

```shell
./update.sh -gd <平台tag>
./update.sh -gdall
# 示例
./update.sh intl
```


### Tags

#### 平台

| Name      | Desc         |
|:--------- |:------------ |
| andr_cn   | 安卓国服     |
| ios_cn    | IOS国服      |
| andr_hk   | 安卓港服     |
| ios_hk    | IOS港服      |
| intl_andr | 安卓国际服   |
| intl_ios  | IOS国际服    |
| kr        | 韩服         |
| h5_cn     | h5国服       |
| h5_tw     | h5台服       |
| ios_uj    | IOS游捷      |
| andr_uj   | 安卓游捷     |
| qq_mini   | QQ小游戏     |
| bd_mini   | 抖音小游戏   |
| wx_mini   | 微信小游戏   |
| h5_qk     | h5           |
| ios_mk    | IOS大闹天宫  |
| andr_mk   | 安卓大闹天宫 |

#### 环境

| Name | Desc         |
|:---- |:------------ |
| dev  | 开发         |
| chan | 渠道         |
| pre  | 预览(废弃)   |
| fix  | 修复（废弃） |
| prod | 生产         |

#### 服务

| Name  | Desc     |
|:----- |:-------- |
| game  | 游戏服   |
| chat  | 聊天服   |
| login | 登录服   |
| rank  | 排行榜服 |

## game_backend

### 运行
1. 修改配置文件
	1. `db.conf` 修改 MySQL 与 Redis 配置文件
	2. `grpc.conf` 修改 `game_conn` 为欲连接到的游戏服rpc地址，其他的服务没有用到可不修改
	3. `app.conf` 修改 `httpport`，如果本地没有占用则可以不用修改
2. 运行

### 推送

```shell
sh docker/andr_hk/push-dev.sh
```

> 开发使用 hk 安卓服

## 持久化

### MySQL

使用 阿里云 RDS MySQL

### Redis

使用 阿里云 云数据库Redis版

## 日志

使用 阿里云 SLS 日志查询服务